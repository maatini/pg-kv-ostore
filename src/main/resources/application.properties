# =============================================================================
# KV and Object Store - Application Configuration
# =============================================================================

# Application info
quarkus.application.name=kv-ostore-psql
quarkus.application.version=1.0.0

# HTTP Configuration
quarkus.http.port=8080
quarkus.http.host=0.0.0.0

# CORS Configuration
quarkus.http.cors=true
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with

# =============================================================================
# Database Configuration
# =============================================================================
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=${DB_USERNAME:postgres}
quarkus.datasource.password=${DB_PASSWORD:postgres}
# quarkus.datasource.reactive.url=vertx-reactive:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:kvstore}
quarkus.datasource.reactive.max-size=20

# Hibernate Reactive
quarkus.hibernate-reactive.database.generation=none
quarkus.hibernate-reactive.log.sql=false
quarkus.hibernate-reactive.physical-naming-strategy=org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy

# Flyway (Enabled for migration management)
quarkus.flyway.enabled=true
quarkus.flyway.migrate-at-start=true

# =============================================================================
# Security Configuration (OIDC/JWT)
# =============================================================================
# Set to false to disable security for development
quarkus.security.auth.enabled-in-dev-mode=${SECURITY_ENABLED:false}

# OIDC Configuration (configure for your identity provider)
quarkus.oidc.enabled=${OIDC_ENABLED:false}
quarkus.oidc.auth-server-url=${OIDC_AUTH_SERVER_URL:https://your-idp.com/realms/your-realm}
quarkus.oidc.client-id=${OIDC_CLIENT_ID:kv-ostore}
quarkus.oidc.credentials.secret=${OIDC_CLIENT_SECRET:secret}
quarkus.oidc.application-type=service

# SmallRye JWT Configuration
mp.jwt.verify.publickey.location=${JWT_PUBLIC_KEY_LOCATION:META-INF/resources/publicKey.pem}
mp.jwt.verify.issuer=${JWT_ISSUER:https://your-idp.com}
smallrye.jwt.sign.key.location=${JWT_PRIVATE_KEY_LOCATION:META-INF/resources/privateKey.pem}

# =============================================================================
# KV Store Configuration
# =============================================================================
kv.max-value-size=${KV_MAX_VALUE_SIZE:1048576}
kv.max-history-size=${KV_MAX_HISTORY_SIZE:100}
kv.cleanup-interval=${KV_CLEANUP_INTERVAL:1h}

# =============================================================================
# Object Store Configuration
# =============================================================================
objectstore.chunk-size=${OBJECTSTORE_CHUNK_SIZE:1048576}
objectstore.max-object-size=${OBJECTSTORE_MAX_OBJECT_SIZE:1073741824}
objectstore.hash-algorithm=${OBJECTSTORE_HASH_ALGORITHM:SHA-256}

# =============================================================================
# WebSocket Configuration
# =============================================================================
quarkus.websocket.max-frame-size=65536
quarkus.websocket.dispatch-to-worker=true

# =============================================================================
# Logging Configuration
# =============================================================================
quarkus.log.console.enable=true
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss.SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.console.level=INFO
quarkus.log.console.color=true

quarkus.log.category."space.maatini".level=DEBUG
quarkus.log.category."org.hibernate.SQL".level=WARN
quarkus.log.category."org.flywaydb".level=INFO

# JSON Logging (for production)
%prod.quarkus.log.console.json=true

# =============================================================================
# Health and Metrics
# =============================================================================
quarkus.smallrye-health.root-path=/health
quarkus.micrometer.export.prometheus.path=/metrics
quarkus.micrometer.binder.jvm=true
quarkus.micrometer.binder.system=true

# =============================================================================
# OpenAPI/Swagger
# =============================================================================
quarkus.smallrye-openapi.path=/openapi
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.path=/swagger-ui

# =============================================================================
# Dev/Test Profile Overrides
# =============================================================================
%dev.quarkus.http.port=8080
%dev.quarkus.log.category."space.maatini".level=DEBUG
%dev.quarkus.hibernate-orm.log.sql=true

%test.quarkus.security.auth.enabled=false
%test.mp.jwt.verify.publickey.location=classpath:META-INF/resources/publicKey.pem
%test.quarkus.datasource.db-kind=postgresql
# %test.quarkus.datasource.username=martinrichardt
# %test.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/kvstore
%test.quarkus.datasource.devservices.enabled=true
%test.quarkus.hibernate-reactive.database.generation=drop-and-create
%test.quarkus.hibernate-orm.database.generation=drop-and-create
%test.jakarta.persistence.schema-generation.database.action=none
%test.quarkus.log.console.level=DEBUG
%test.quarkus.flyway.enabled=true
%test.quarkus.flyway.clean-at-start=true
%test.quarkus.flyway.baseline-on-migrate=true
